<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Home|CogSMART-Z</title>
    <link rel="icon" href="assets/logo.svg" type="image/svg">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Quicksand">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <header class="header-navbar">
        <nav class="navbar navbar-expand-md navbar-light navbar-color sticky-top">
            <div class="container-fluid">
                <a class="navbar-brand d-flex align-items-center" href="home.html">
                    <img src="assets/logo.svg" alt="CogSMART-Z logo" class="logo me-3">
                    <span>CogSMART-Z</span>
                </a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar"
                    aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="mainNavbar">
                    <ul class="navbar-nav me-auto mb-2 mb-md-0">
                        <li class="nav-item">
                            <a class="nav-link d-inline-flex align-items-center" href="home.html"><ion-icon
                                    name="home-outline" class="fs-5 p-0 m-0 me-1" aria-hidden="true"></ion-icon>Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link d-inline-flex align-items-center" href="modules.html"><ion-icon
                                    name="grid-outline" class="fs-5 p-0 m-0 me-1"
                                    aria-hidden="true"></ion-icon>Modules</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link d-inline-flex align-items-center" href="about.html"><ion-icon
                                    name="information-circle-outline" class="fs-5 p-0 m-0 me-1"
                                    aria-hidden="true"></ion-icon>About</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link d-inline-flex align-items-center" aria-current="page"
                                href="resources.html"><ion-icon name="book" class="fs-5 p-0 m-0 me-1"
                                    aria-hidden="true"></ion-icon>Resources</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle d-inline-flex align-items-center" href="#"
                                id="toolsDropdown" role="button" data-bs-toggle="dropdown"
                                aria-expanded="false"><ion-icon name="construct-outline" class="fs-5 p-0 m-0 me-1"
                                    id="UtilitiesIcon" aria-hidden="true"></ion-icon>Utilities</a>
                            <ul class="dropdown-menu navbar-color" aria-labelledby="toolsDropdown">
                                <li><a class="dropdown-item" href="assessment.html">Assessment</a></li>
                                <li><a class="dropdown-item" href="training.html">Training</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link d-inline-flex align-items-center" href="settings.html"><ion-icon
                                            name="settings-outline" class="fs-5 p-0 m-0 me-1"
                                            aria-hidden="true"></ion-icon>Settings</a>
                                </li>
                            </ul>
                        </li>
                    </ul>

                    <!-- Search Bar -->
                    <form class="d-flex" role="search" action="search.html" method="get">
                        <div class="input-group">
                            <input class="form-control search-bar" type="search" name="q" placeholder="Search"
                                aria-label="Search">
                            <button class="btn btn-primary border-0 d-flex align-items-center search-btn "
                                type="submit"><ion-icon name="search-outline" class="fs-5 p-0 m-0"
                                    aria-hidden="true"></ion-icon></button>
                        </div>
                    </form>

                    <!-- Sign Out Button-->
                    <button type="button" class="btn btn-outline-danger ms-2" data-bs-toggle="modal"
                        data-bs-target="#signOutModal">
                        Sign Out
                    </button>

                </div>
            </div>
        </nav>
    </header>

    <!-- Sign Out Modal -->
    <div class="modal fade" id="signOutModal" tabindex="-1" aria-labelledby="signOutModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="signOutModalLabel">Sign Out</h5>
                    <button type="button" class="btn-close" data- bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to sign out?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <form action="/signout" method="post" class="d-inline">
                        <button type="submit" class="btn btn-danger">Sign Out</button>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <main class="container my-5">
        <!-- Hero -->
        <section class="py-4 mb-4 rounded-3 text-white" style="background: linear-gradient(135deg,#4f8ef7,#6dd3b0);">
            <div class="container-fluid py-3">
                <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between">
                    <div>
                        <h1 class="h2 fw-bold mb-1">Resources</h1>
                        <p class="mb-0 opacity-75">Curated materials to support training, assessment, and implementation
                            of CogSMART‑Z.</p>
                    </div>
                    <div class="mt-3 mt-md-0 d-flex gap-2">
                        <a class="btn btn-outline-light" href="#" role="button"><ion-icon name="download-outline"
                                class="me-1"></ion-icon>Download All</a>
                        <a class="btn btn-light text-primary" href="modules.html" role="button"><ion-icon
                                name="grid-outline" class="me-1"></ion-icon>Explore Modules</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Controls -->
        <section class="mb-4">
            <div class="row g-2 align-items-center">
                <div class="col-md-5">
                    <div class="input-group">
                        <span class="input-group-text bg-white"><ion-icon name="search-outline"></ion-icon></span>
                        <input id="resources-search" class="form-control" type="search"
                            placeholder="Search resources, guides, articles..." aria-label="Search resources">
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="d-flex gap-2">
                        <select id="resources-category" class="form-select">
                            <option value="all">All categories</option>
                            <option value="guides">Guides</option>
                            <option value="worksheets">Worksheets</option>
                            <option value="research">Research</option>
                            <option value="videos">Videos</option>
                            <option value="tools">Tools</option>
                        </select>

                        <select id="resources-sort" class="form-select d-none d-md-block" aria-label="Sort resources">
                            <option value="relevance">Sort: Relevance</option>
                            <option value="newest">Newest</option>
                            <option value="popular">Most popular</option>
                        </select>
                    </div>
                </div>

                <div class="col-md-3 text-md-end">
                    <div class="btn-group" role="group" aria-label="resource-tags">
                        <button class="btn btn-outline-secondary btn-sm tag-btn" data-tag="all">All</button>
                        <button class="btn btn-outline-secondary btn-sm tag-btn" data-tag="clinical">Clinical</button>
                        <button class="btn btn-outline-secondary btn-sm tag-btn" data-tag="training">Training</button>
                        <button class="btn btn-outline-secondary btn-sm tag-btn" data-tag="download">Download</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Resource grid -->
        <section id="resources-grid" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            <!-- Resource cards will be dynamically loaded here -->
        </section>

        <!-- Filter Messages -->
        <section id="resources-loading" class="text-center py-5 d-none">
            <p class="mb-0 text-muted">Loading resources…</p>
        </section>

        <section id="resources-load-error" class="text-center py-5 d-none">
            <p class="mb-0 text-muted">
                Could not load resources. Try checking your internet connection.<br>
                If the problem persists, please contact support.
            </p>
        </section>

        <section id="resources-no-match" class="text-center py-5 d-none">
            <p class="mb-0 text-muted">No resources match your filters. Try clearing search or selecting a different
                category.</p>
        </section>

        <!-- FAQ Accordion -->
        <section class="mt-5">
            <h4 class="h6 mb-3">Quick help</h4>
            <div class="accordion" id="resourcesFaq">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faqOne">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#faqOneCollapse" aria-expanded="false" aria-controls="faqOneCollapse">
                            How do I download materials?
                        </button>
                    </h2>
                    <div id="faqOneCollapse" class="accordion-collapse collapse" aria-labelledby="faqOne"
                        data-bs-parent="#resourcesFaq">
                        <div class="accordion-body small text-muted">
                            Click the download icon next to any resource. For bulk downloads, use the "Download All"
                            button in the header.
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="faqTwo">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#faqTwoCollapse" aria-expanded="false" aria-controls="faqTwoCollapse">
                            Can I request additional resources?
                        </button>
                    </h2>
                    <div id="faqTwoCollapse" class="accordion-collapse collapse" aria-labelledby="faqTwo"
                        data-bs-parent="#resourcesFaq">
                        <div class="accordion-body small text-muted">
                            Contact your program administrator or open an issue in the project repository for resource
                            requests and contributions.
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        let resourcesLoaded = false; // flag to 

        // Load resources from JSON and render into the grid
        async function loadResources() {
            const grid = document.getElementById('resources-grid');

            // Show loading message
            // document.getElementById('resources-loading').classList.remove('d-none');
            document.getElementById('resources-loading').classList.remove('d-none');
            document.getElementById('resources-load-error').classList.add('d-none'); // Hide load error message
            document.getElementById('resources-no-match').classList.add('d-none'); // Hide no match message


            try {
                const res = await fetch('resources.json');
                if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
                const data = await res.json();

                // Sorting: respect the sort control value
                const sort = document.getElementById('resources-sort')?.value || 'relevance';
                if (sort === 'newest') {
                    data.sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0));
                } else if (sort === 'popular') {
                    data.sort((a, b) => (b.popularity || 0) - (a.popularity || 0));
                }

                // Hide loading message
                document.getElementById('resources-loading').classList.add('d-none');

                // helper: format ISO-ish date strings to readable form
                function formatDate(d) {
                    if (!d) return '';
                    const dt = new Date(d);
                    if (isNaN(dt)) return d; // return raw if invalid
                    return dt.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
                }

                data.forEach(item => {
                    const col = document.createElement('article');
                    col.className = 'col resource-card';
                    col.dataset.category = item.category || '';
                    col.dataset.tags = (item.tags || []).join(',');
                    col.dataset.title = item.title || '';

                    const badgesHtml = (item.badges || []).map(b => `<span class="badge bg-${b.color} me-1">${b.text}</span>`).join('');

                    const downloadBtn = item.downloadUrl ? `<a href="${item.downloadUrl}" class="btn btn-sm btn-primary" download><ion-icon name="download-outline"></ion-icon></a>` : '';
                    const viewBtn = item.viewUrl ? `<a href="${item.viewUrl}" class="btn btn-sm btn-outline-primary" target="_blank" rel="noopener">${item.viewLabel || 'Open'}</a>` : '';

                    col.innerHTML = `
                    <div class="card h-100 shadow-sm">
                        <div class="card-body d-flex flex-column">
                            <div class="d-flex align-items-center mb-3">
                                <div class="me-3 bg-light rounded p-2" style="width:56px;height:56px;display:flex;align-items:center;justify-content:center;">
                                    <ion-icon name="${item.icon || 'document-text-outline'}" size="large"></ion-icon>
                                </div>
                                <div>
                                    <h3 class="h6 mb-0">${item.title}</h3>
                                    <small class="text-muted d-block">${item.subtitle || ''}</small>
                                    <small class="text-muted">${formatDate(item.date)}</small>
                                </div>
                            </div>
                            <p class="mb-3 small text-muted">${item.description || ''}</p>
                            <div class="mt-auto d-flex justify-content-between align-items-center">
                                <div>
                                    ${badgesHtml}
                                </div>
                                <div class="btn-group">
                                    ${viewBtn}
                                    ${downloadBtn}
                                </div>
                            </div>
                        </div>
                    </div>`;

                    grid.appendChild(col);
                });

                // Mark resources loaded and hide loading message
                resourcesLoaded = true;
                document.getElementById('resources-loading').classList.add('d-none'); // Hide loading message

                applyFilters();
            } catch (err) {
                console.error('Failed loading resources.json', err);

                resourcesLoaded = false;
                document.getElementById('resources-load-error').classList.remove('d-none'); //Show load error message
                document.getElementById('resources-loading').classList.add('d-none'); // Hide loading message
                document.getElementById('resources-no-match').classList.add('d-none'); // Hide no match message
            }
        }

        // Filtering and search
        function applyFilters() {
            const q = (document.getElementById('resources-search').value || '').toLowerCase();
            const category = document.getElementById('resources-category').value;
            const tagButtons = document.querySelectorAll('.tag-btn');
            const activeTag = Array.from(tagButtons).find(b => b.classList.contains('active'))?.dataset.tag || 'all';

            const cards = document.querySelectorAll('.resource-card');
            let visibleCards = 0;
            cards.forEach(card => {
                const title = (card.dataset.title || '').toLowerCase();
                const tags = (card.dataset.tags || '').toLowerCase();
                const cat = (card.dataset.category || '').toLowerCase();

                const matchesQuery = !q || title.includes(q) || tags.includes(q);
                const matchesCategory = category === 'all' || cat === category;
                const matchesTag = activeTag === 'all' || tags.split(',').includes(activeTag);

                const show = matchesQuery && matchesCategory && matchesTag;
                card.style.display = show ? '' : 'none';
                if (show) visibleCards++;
            });

            // Show no matching resources message
            document.getElementById('resources-no-match').classList.toggle('d-none', visibleCards !== 0 && resourcesLoaded);
            document.getElementById('resources-loading').classList.add('d-none'); // Hide loading message
            document.getElementById('resources-load-error').classList.add('d-none'); // Hide load error message
        }

        // Wire up controls
        document.addEventListener('DOMContentLoaded', () => {
            loadResources().catch(err => console.error(err));

            document.getElementById('resources-search').addEventListener('input', () => applyFilters());
            document.getElementById('resources-category').addEventListener('change', () => applyFilters());
            document.getElementById('resources-sort').addEventListener('change', () => loadResources());

            document.querySelectorAll('.tag-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.tag-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    applyFilters();
                });
            });
        });
    </script>


    <!-- Custom Script -->
    <script src="script.js"></script>


    <!-- IonicIcons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>


    <!--- Bootstrap JS CDN ---
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
        --->
    <!--- Bootstrap Popper CDN --->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js"
        integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y"
        crossorigin="anonymous"></script>
</body>

</html>